runOn:
  - minServerVersion: "6.0.0"
database_name: &database_name "default"
collection_name: &collection_name "default"

data: []

key_vault_data: []

encrypted_fields: {
  "fields": []
}

tests:
  - description: "encryptionInformation is added without encryption"
    clientOptions:
      autoEncryptOpts:
        kmsProviders:
          local: {
            "key": {
              "$binary": {
                "base64": "Mng0NCt4ZHVUYUJCa1kxNkVyNUR1QURhZ2h2UzR2d2RrZzh0cFBwM3R6NmdWMDFBMUN3YkQ5aXRRMkhGRGdQV09wOGVNYUMxT2k3NjZKelhaQmRCZGJkTXVyZG9uSjFk",
                "subType": "00"
              }
            }
          }
    operations:
      - name: insertOne
        arguments:
          document: &doc0 {
            _id: 1,
            foo: "bar"
          }
    expectations:
      # Auto encryption will request the collection info.
      - command_started_event:
          command:
            listCollections: 1
            filter:
              name: *collection_name
          command_name: listCollections
      - command_started_event:
          command:
            insert: *collection_name
            documents:
              - *doc0
            encryptionInformation: {
                "type": {
                    "$numberInt": "1"
                },
                "schema": {
                    "default.default": {
                        "fields": [],
                        "escCollection": "enxcol_.default.esc",
                        "eccCollection": "enxcol_.default.ecc",
                        "ecocCollection": "enxcol_.default.ecoc"
                    }
                }
              }
            ordered: true
          command_name: insert
    outcome:
      collection:
        # Outcome is checked using a separate MongoClient without auto encryption.
        data:
          - *doc0